sudo: false

language: scala

jdk: oraclejdk8

before_cache:
- find $HOME/.sbt -name "*.lock" -print -delete
- find $HOME/.ivy2/cache -name "ivydata-*.properties" -print -delete
cache:
  directories:
  - "$HOME/.ivy2/cache"
  - "$HOME/.sbt"

before_install:
# Ensure git tags are always fetched so sbt-dynver can pick up correct version
- git fetch --tags
# Extract GPG keys only when
- if [ $TRAVIS_PULL_REQUEST = "false" ]; then
  openssl aes-256-cbc -K $encrypted_624c4e31574a_key -iv $encrypted_624c4e31574a_iv -in travis/secrets.tar.enc -out travis/local.secrets.tar -d;
  tar xv -C travis -f travis/local.secrets.tar;
  fi

stages:
- name: build
- name: publish
  if: type = push
- name: release
  if: tag IS present

jobs:
  include:
  - stage: build
    env: TRAVIS_SCALA_VERSION=2.11.12
    script: sbt ++$TRAVIS_SCALA_VERSION clean compile test
  - env: TRAVIS_SCALA_VERSION=2.12.6
    script: sbt ++$TRAVIS_SCALA_VERSION clean compile test

  - stage: publish
    env: TRAVIS_SCALA_VERSION=2.11.12
    script: sbt ++$TRAVIS_SCALA_VERSION publishSigned
  - env: TRAVIS_SCALA_VERSION=2.12.6
    script: sbt ++$TRAVIS_SCALA_VERSION publishSigned

  - stage: release
    env: TRAVIS_SCALA_VERSION=2.11.12
    script: sbt ++$TRAVIS_SCALA_VERSION sonatypeRelease
  - env: TRAVIS_SCALA_VERSION=2.12.6
    script: sbt ++$TRAVIS_SCALA_VERSION sonatypeRelease